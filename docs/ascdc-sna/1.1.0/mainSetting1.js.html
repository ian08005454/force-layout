<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mainSetting1.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-keywordCleaner-searchTarget.html">searchTarget</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="searchWord.html">searchWord</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="searchWord.html#.keywordCleanUp">keywordCleanUp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="searchWord.html#.keywordNot">keywordNot</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="searchWord.html#.lineAppend">lineAppend</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-API.html">API</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-API.html#.GetJSON">GetJSON</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-chartSetting.html">chartSetting</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-dataFormater.html">dataFormater</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-graphologyLayoutSystem.html">graphologyLayoutSystem</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-keywordCleaner.html">keywordCleaner</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-keywordCleaner.html#.keywordCleanUp">keywordCleanUp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-keywordCleaner.html#.keywordItemAppend">keywordItemAppend</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-keywordCleaner.html#~keyword_item_delete">keyword_item_delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-keywordCleaner.html#~lineCtrl">lineCtrl</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-searchFunction.html">searchFunction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-searchFunction.html#.changeMaxlevel">changeMaxlevel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-searchFunction.html#.searchKeyword">searchKeyword</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-searchFunction.html#~andSearch">andSearch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-searchFunction.html#~andSearchNoRoute">andSearchNoRoute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-searchFunction.html#~data_filter">data_filter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-searchFunction.html#~dataAppendOr">dataAppendOr</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-searchFunction.html#~floodingSearch">floodingSearch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-searchFunction.html#~lineOr">lineOr</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-sliderbarSetting.html">sliderbarSetting</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-sliderbarSetting.html#.silderInit">silderInit</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#adaptiveTimeStepWeight">adaptiveTimeStepWeight</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#debug">debug</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#dimensions">dimensions</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#dragCoefficient">dragCoefficient</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#gravity">gravity</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#keyword_search">keyword_search</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#keywordFliter">keywordFliter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#label_rotate">label_rotate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#lineCtrl">lineCtrl</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#shuffle">shuffle</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#springCoefficient">springCoefficient</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#springLength">springLength</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#theta">theta</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#timeStep">timeStep</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">mainSetting1.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Main_setting
 * @author Wei-Jie Li
 * @createDate 2020-05-21
 */
//To do list:
//將slider bar 分開來
//將模組以keyword 和 keywordCollection 為基礎分割
import { keywordItemAppend, keywordCleanUp } from "./keywordCleaner.js";
import { searchKeyword, changeMaxlevel } from "./searchFunction.js";
import { silderInit, sliderBar, centrality } from "./sliderbarSetting.js";
import { dataFormat, userColors, allValues, allIdf } from "./dataFormater.js";
import { colorPanelInit } from "./colorPanelSetting.js";
// init HTML dom
$('.sidebar').hide();//在圖還沒形成之前要先將左邊的slider隱藏
const Chart = echarts.init(document.getElementById('main'), null, {
    renderer: 'canvas', //could be svg, but may have performance problems
    // 如果宽高比大于 1 则宽度为 100，如果小于 1 则高度为 100，保证了不超过 100x100 的区域
    // 设置这两个值后 left/right/top/bottom/width/height 无效。
    // width: 1700,
    // height: 800 //有置中問題
});
Chart.showLoading('default');//轉圈圈~~
var start = new Date().getTime();
export const data = dataFormat(jdata);//資料整理模組
console.log("data:")
console.log(data);
Chart.hideLoading(); //跑好後關圈圈~~~
$('.sidebar').show();//圖形顯示後再出現slider
var End = new Date().getTime();
console.log(End-start + 'ms');
var max_common_show_value = Math.max(...allValues);
var min_common_show_value = Math.min(...allValues);
var max_idf = Math.max(...allIdf);
var min_idf = Math.min(...allIdf);
export var option = {
    title: {
        // text: 'Lorem ipsum', // this field will connect to the book name
        // subtext: 'Lorem ipsum',
        textStyle: {
            fontSize: 32,
            fontWeight: 'bolder'
        },
        subtextStyle: {
            fontSize: 15,
            fontWeight: 'bolder'
        }

    },
    tooltip: {
        show: true,
        // showContent:false, //mouseover是否顯示
    },
    toolbox: {
        left: 'right',
        show: true,
        feature: {
            magicType: { show: true, type: ['force', 'chord'] },
            saveAsImage: {
                show: true,
                title: '存成圖片',
                type: 'png'
            },
            // ! dataView still have to fix
            // dataView: {
            //     show: true,
            //     title: 'data',
            //     readOnly: false,
            //     lang: ['Detail Data Information', 'Close', 'refresh'],
            // }, 
            restore: {
                show: true,
                title: 'restore'
            },
            magicType: {show:true, type: ['force', 'chord']}
        }
    },
    // legend: {
    //     type: 'scroll',
    //     data: data.category,
    //     tooltip: {
    //         show: false,
    //     },
    //     orient: 'vertical',
    //     pageButtonPosition: 'start',
    //     selectedMode: 'true',
    //     width: 100,
    //     height: 140,
    //     right: 50
    // },
    series: [{
        type: 'graph',
        layout: 'force',
        categories: data.category,
        nodes: data.nodes,
        modularity: true,
        links: data.links,
        // edges : {
        //     label : {
        //         show : false, 
        //         // formatter : 
        //     }
        // },
        // symbol : 'rect',//node形狀
        itemStyle: {
            normal: {
                label: {
                    fontFamily: 'sans-serif',
                    show: true,
                    textStyle: {
                        // color: 'white',
                        fontSize: 17
                    },
                    formatter:function(param){
                        return param.name + `(` + param.data.idf + `)` ;
                    },
                    // position : 'left'
                },
                color: 'pink' //預設node顏色
            }
        },
        draggable: true,//單獨點的移動
        roam: true,//禁止使用者作放大縮小 只准拖動 true,'move','scale',false
        focusNodeAdjacency: true,
        nodeScaleRatio: 0.1, 
        force: {
            friction: 0.1,
            initLayout:'circular',
            repulsion: 220,
            // todo : fix the jquery slider
            edgeLength: [200, 400], 
            // gravity : 1,
            gravity : 0.01,
            layoutAnimation: true//開始的晃動動畫
        },
        edgeSymbol: ['arrow'],
        symbolRotate :0.6,
        edgeSymbolSize: 10,
        edgeLabel: {
            fontFamily: 'sans-serif',
            normal: {
                verticalAlign: 'bottom',
                show: true,
                textStyle: {
                    fontSize: 18
                },
                formatter: function (param) {
                    // param.name = `${param.data.target}>${param.data.source}`;
                    return param.data.name + `(` + param.data.value + `)` ;
                },
                position: 'middle',
                align: 'center',
            }
        },
        lineStyle: {
            normal: {
                opacity: 1,
            }
        },
        zoom: 1
    }]
}
// jquery_slider_setting
export var jquery_slider_setting = [{
    object: 'relation_strength',
    min: 0,
    max: 100,
    step: 1,
    value: 0,
    disable: false,
    range: 'min'
}, {
    object: 'group_label_distance',
    min: 0,
    max: 100,
    step: 1,
    value: 0,
    disable: false,
    range: 'min'
},{
    object: 'node_distance',
    min: 1,
    max: 100,
    step: 1,
    value: option.series[0].force.repulsion / 100,
    disable: false,
    range: 'min'
},{
    object: 'relation_link_width',
    min: 0.5,
    max: 5,
    step: 0.5,
    value: 1,
    disable: false,
    range: 'min'
}, {
    object: 'main_screen_room',
    min: 0.1,//option.series[0].zoom,
    max: 2,
    step: 0.1,
    value: option.series[0].zoom,
    disable: false,
    range: 'min'
}, {
    object: 'relation_font_size',
    min: 5,
    max: 100,
    step: 1,
    value: option.series[0].edgeLabel.normal.textStyle.fontSize,
    disable: false,
    range: 'min'
}, {
    object: 'subject_font_size',
    min: 5,
    max: 100,
    step: 1,
    value: option.series[0].itemStyle.normal.label.textStyle.fontSize,
    disable: false,
    range: 'min'
}, {
    object: 'node_size',
    min: 0.2,
    max: 5,
    step: 0.2,
    value: 1,
    disable: false,
    range: 'min'
}, {
    object: 'common_show_value',
    min: min_common_show_value - 1,
    max: max_common_show_value,
    step: 1,
    value: min_common_show_value,
    disable: false,
    range: 'min'
}, {
    object: 'word_strength',//idf詞頻強度
    min: min_idf -1,
    max: max_idf,
    step: 1,
    value: min_idf,
    disable: false,
    range: 'min'
}
];
const hexToRgb = hex =>
  hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
             ,(m, r, g, b) => '#' + r + r + g + g + b + b)
    .substring(1).match(/.{2}/g)
    .map(x => parseInt(x, 16))
const rgbToHex = (r, g, b) => '#' + [r, g, b]
    .map(x => x.toString(16).padStart(2, '0')).join('')
if(dataType === 1){
    option.series[0].edgeLabel.normal.show = false;
    option.series[0].edgeSymbol = [];
    option.series[0].edgeLabel.normal.formatter = function (param) {
        return param.data.value;
    };
    // data.category.forEach(category=>{
    //     var color = [];
    //     data.nodes.forEach(node =>{
    //         if(node.name === category.target || node.name === category.source)
    //             color.push(node.itemStyle.normal.color);
    //     })
    //     console.log(color);
    //     var target = hexToRgb(color[0]);
    //     var source = hexToRgb(color[1]);
    //     color = [];
    //     for (let index = 0; index &lt; target.length; index++) {
    //         color[index] = parseInt((target[index] + source[index])/2);
            
    //     }
    //     category.lineStyle.normal.color = rgbToHex(color[0], color[1], color[2]);
    //     console.log(category.lineStyle.normal.color);
    // })
    $('.lineSelected').hide();
    $('#kModel').hide();
    $('.current_relation').hide();
}
else if(dataType === 2){
    option.series[0].edgeLabel.normal.formatter = function (param) {
        return param.data.name;
    };
    option.series[0].itemStyle.normal.label.formatter = function (param) {
        return param.name;
    };
    $(".common_show_value").hide();
    $(".word_strength").hide();
}
var edgeMask = [[],[]];
option.series[0].categories.forEach(category =>{
    if(!edgeMask[0].includes(category.id) &amp;&amp; !edgeMask[1].includes(category.id))
    option.series[0].categories.forEach(item =>{
        if(item.target === category.source &amp;&amp; item.source === category.target){
            if(item.name === category.name){
                if(!edgeMask[0].includes(category.id) &amp;&amp; !edgeMask[1].includes(category.id)){
                    edgeMask[0].push(category.id);
                    edgeMask[1].push(item.id);
                }
            }
        }
    })
})
// ! setup all option
/**
 * 儲存max_level slider的現值
 * @type {string}
 */
var routeFloor = 'All';
var result, viewResult;
var keywords = [];
window.onresize = () => {
    Chart.resize();
};
let allLine = data.all_category.map(function(item, index, array) {
    return item.name;
});
// EventListener
$('#keyword_search_field').keyup((e) => {
    keyword_search(e);
});
$('#keyword_search_button').on('click', keyword_search);
/**
 * 將不要的關係從圖中移除，資訊由{@link notKeyword}和{@link lineStack}取得
 */
function lineCtrl(lineStack,notKeyword) {
    data.all_category = data.all_category.filter((category) => {
        category.show = true;
        return category;
    });
    if (lineStack.length !== 0) {
        lineStack.forEach((item) => {
            let bench = [];
            if (Array.isArray(item)) {
                data.all_category.filter((category) => {
                    if (item.includes(category.name)) bench.push(category.target, category.source);
                });
                for (let i = 1; i &lt; item.length; i++)
                    bench = bench.filter(function(element, index, arr) {
                        return arr.indexOf(element) !== index;
                    });
                data.all_category = data.all_category.filter((category) => {
                    if (item.includes(category.name)) {
                        if (bench.includes(category.target) &amp;&amp; bench.includes(category.source)) category.show = false;
                    }
                    return category;
                });
            } else {
                if (item === '無共現') {
                    data.all_category = data.all_category.filter((category) => {
                        if (category.value === 0) category.show = false;
                        return category;
                    });
                } else {
                    data.all_category = data.all_category.filter((category) => {
                        if (item === category.name) category.show = false;
                        return category;
                    });
                }
            }
        });
    }
    console.log(notKeyword.length);
    if(notKeyword.length !== 0){
        data.all_category = data.all_category.filter((category) => {
            if (notKeyword.includes(category.target) ||　notKeyword.includes(category.source)) category.show = false;
            return category;
        });
    }
}
/**
 * 搜尋的進入點，由此函式區分這次搜尋要傳到個方法
 */
function keyword_search(e) {
    if (e. which=== 13 || e.type === 'click') {
        //點搜尋或按ENTER
        let keyword_search_name = $('#keyword_search_field').val();
        keyword_search_name = keyword_search_name.toLowerCase();
        keyword_search_name = keyword_search_name.replace(' and ', '&amp;');
        keyword_search_name = keyword_search_name.replace(' or ', '|');
        var keywordSearchType = $('#kClass').val();
        if (dataType === 1) var keywordModel = 'node';
        else var keywordModel = $('#kModel').val();
    let name_s = [];
    let name_ss = [];
    if (keyword_search_name.includes('|'))
        name_s = keyword_search_name.split('|'); //拆解or
    else name_s.push(keyword_search_name);
    name_s.forEach((item) => {
        //拆到剩下單一名詞的陣列
        if (item.includes('&amp;')) {
            item = item.split('&amp;');
            item.forEach((t) => {
                name_ss.push(t);
            });
        } else name_ss.push(item);
    });
    console.log(name_ss);
    if (keywordModel === 'node')
        name_ss.forEach((item) => {
            //檢查點
            if (!data.all_nodes.includes(item)) throw alert(`Error1 : 找不到關鍵字:${keyword_search_name}`);
        });
    else
        name_ss.forEach((item) => {
            //檢查線
            if (!allLine.includes(item)) throw alert(`Error1 : 找不到關鍵字:${keyword_search_name}`);
        });
        let answer = keywordItemAppend(keyword_search_name, keywordSearchType, keywordModel);
        if(answer === 0)   keywordFliter();
    }
}
/**
 * 做搜尋的init並檢查node是否有在data內，並執行搜尋程式
 */
export function keywordFliter() {
    // routeFloor = 'All';
    result = keywordCleanUp();
    if(result.lineStack.length !== 0 || result.notKeyword !== 0)
        lineCtrl(result.lineStack, result.notKeyword);
    if(result.keywordCollection.length === 0)
        resetChart();
    else{
        viewResult = searchKeyword(result.keywordCollection, 'All');
        if(routeFloor != 'All' &amp;&amp; viewResult.routeHash.includes(routeFloor)){
        viewResult = changeMaxlevel(result.keywordCollection, routeFloor);
        }
        else if(!viewResult.routeHash.includes(routeFloor))
        routeFloor = 'All';
        if(routeFloor != 'All') var value = routeFloor;
        else var value = viewResult.routeHash.length;
        viewDataChange();
        $(`.slider_item > #max_level`).slider({
            min: 0,
            max: viewResult.routeHash.length, //最大階層數
            step: 1,
            value: value, //current option setting value
            disable: false,
            range: 'min'
        });
        $(`.slider_item > input[id=max_level]`).val(routeFloor);
        $('.max_level').show();
    }
}
function viewDataChange() {
    option.series[0].categories = viewResult.category
    option.series[0].links = viewResult.links
    keywords = [];
    result.keywordCollection.forEach((item) =>{
        item.nodeName.forEach((node) =>{
            keywords.push(node);
        });
    });
    option.series[0].nodes = viewResult.nodes.filter((node) => {
        keywords.includes(node.name)
        ? (node.itemStyle.normal.color = 'red')
        : (node.itemStyle.normal.color = userColors[node.gp]);
        return node;
    });
    event_setOption_function();
}
// compute the data which will render on canvas
// IMPORTANT FUNCTION !! DO NOT CHANGE ANY PARAMETER IN THIS FUNCTION
// compute the data when occurs the legendselectchanged event on category bar

// todo : improve the performance

// Chart.on('legendselectchanged', (category_select) => {

// });

function switchType() {
    if (option.series[0].layout === 'circular') option.series[0].layout = 'force';
    else option.series[0].layout = 'circular';
    event_setOption_function();
}
function lineListChange(e) {
    console.log(e.target.value);
    keywordItemAppend(e.target.value, 'not', 'line');
    keywordFliter()
}
function resetChart() {
    let collect = [];
    // console.log("reset");
    //刪除完全數清空或是砍了第一層
    option.series[0].categories = data.all_category.filter((category) => {
        // return the category that show property is true
        if (category.show == true) {   
                collect.push(category.source, category.target);
                return category;
        }
    });
    option.series[0].links = option.series[0].categories;
    collect = Array.from(new Set(collect));
    option.series[0].nodes = data.nodes.filter((node) => {
        node.itemStyle.normal.color = userColors[node.gp];
        return collect.includes(node.name);
    });
    event_setOption_function(true);
}
// max_level
function max_Level(ui_value) {
    if (ui_value === viewResult.routeHash.length) routeFloor = 'All';
    else routeFloor = viewResult.routeHash[ui_value];
    $(`.slider_item > input[id=max_level]`).val(routeFloor);
    viewResult = changeMaxlevel(result.keywordCollection, routeFloor);
    console.log(viewResult);
    viewDataChange();
}

// the involve function that will read the jquery_slider_setting in Main_setting.js, then create the jquery slider
$(() => {
    $('.max_level').hide()
    silderInit();
    $('.slider_slider').slider({slide: function(e, ui){
        if(e.target.id === 'max_level')
            max_Level(ui.value);
        else
            sliderBar(e, ui)
            event_setOption_function(false);
        }   
    });
    document.querySelector('.centralitySelecter').onchange = function(e){centrality(e.target.value)};
    document.querySelector('.switch-input').onclick = function(e){switchType()};
    document.querySelector('.alone').onclick = function(e){
        sliderBar('All');
        event_setOption_function();
    };
    event_setOption_function();
    End = new Date().getTime();
    console.log(End-start + 'ms');
});
// The function to render the data to canvas after set all option finish
function event_setOption_function(rander = true) {
        nodeList();
        lineList();
        if($('#Cselecter').val() !== '')
            sliderBar('All');
        edgeFilter();
    // nodeTypeChange();
    Chart.setOption(option, rander);
    function nodeList() {
        $('.current_node').html(`顯示的點 : (${option.series[0].nodes.length})`);
        $('.nodeSelected').children().remove();
        var index = 0;
        for (const name of groupName) {
            const details = document.createElement('details');
            var summary = document.createElement('summary');
            summary.appendChild(document.createTextNode(name));
            var colorLump = document.createElement('button')
            colorLump.className = "color-lump";
            colorLump.role = "button";
            colorLump.name = index;
            colorLump.value = colorLump.style.backgroundColor = userColors[index];
            colorLump.id = 'node'
            summary.appendChild(colorLump);
            details.appendChild(summary);
            details.className = `nodeList${index}`;
            $('.nodeSelected').append(details); 
            option.series[0].nodes.forEach((item) => {
                if(item.gp === index){
                    var lableName = item.name;
                var disabled = '';
                if(viewResult !== undefined){
                    if (viewResult.route.length !== 0 ) {
                        var routeCount = 0;
                        viewResult.route.forEach((element) => {
                            if (element.includes(item.name)) routeCount++;
                        });
                        if (viewResult.route.length === routeCount)
                            lableName = `${item.name} (必要)`
                    }
                }
                if (keywords.includes(item.name))
                disabled = `disabled="disabled"`;
                $(`.nodeList${index}`).append(`&lt;div class="nodeSelected_item" value="${item.name}">
                 &lt;label>&lt;font color="${item.itemStyle.normal.color}">&lt;input type="checkbox" id="${item.name}" name="node_list" value="${item.name}" ${disabled}  checked >${lableName}&lt;/front>&lt;/label>
                 &lt;div class="color-lump" style="background-color:${item.itemStyle.normal.color}">&lt;/div>&lt;/div>`);
                }
            });
            index ++;
        }
       
        $('.nodeSelected').scrollTop(function() {
            return this.scrollHeight;
        });
        document.querySelector('.nodeSelected').onchange = function(e){nodeListChange(e)};

    }
    function lineList() {
        let mustLine = [];
        $('.current_relation').html(`顯示的線 : (${option.series[0].links.length})`);
        $('.lineSelected').children().remove();
        let list = [];
        if (viewResult !== undefined &amp;&amp; viewResult.route.length !== 0) {
            for (let index = 1; index &lt; viewResult.route.length; index++) {
                mustLine = mustLine.filter(function(element, index, arr) {
                    return arr.indexOf(element) !== index;
                });
            }
        }
        option.series[0].categories.forEach((item) => {
            if (item.value === 0) {
                if (!list.includes('無共現')) {
                    list.push('無共現');
                    $('.lineSelected').append(`&lt;div class="lineSelected_item" data-item="無共現">
                &lt;label>&lt;font color="gray">&lt;input type="checkbox" name="node_list" value="無共現" checked>無共現(0)&lt;/front>&lt;/label>&lt;/div>&lt;div class="color-lump" style="background-color:"gray">&lt;/div>`);
                }
            }
        });
        option.series[0].categories.forEach((item) => {
            if (!list.includes(item.name)) {
                list.push(item.name);
                var name = item.name;
                if (mustLine.includes(item.name)) {
                    name = `${item.name} (必要)`
                }
                    $('.lineSelected').append(`&lt;div class="lineSelected_item" value="${item.name}">
                &lt;label>&lt;font color="${item.itemStyle
                    .color}">&lt;input type="checkbox" name="lineList" value="${item.name}" checked>${name}&lt;/front>&lt;/label>&lt;/div>&lt;div classs="${item.name}">&lt;button id='line' class="color-lump" role="button"  name="${item.name}" value="${item.itemStyle.color}" style="background-color: ${item
                        .itemStyle.color}">&lt;/button>&lt;/div>`);
            }
        });
        $('.lineSelected').scrollTop(function() {
            return this.scrollHeight;
        });
        document.querySelector('.lineSelected').onchange = function(e){lineListChange(e)};
        $('button.color-lump').off('click').click((e) => {
            console.log(e.currentTarget.name);
            console.log(e.currentTarget.value);
            console.log(e.currentTarget.id);
            colorPanelInit(e.currentTarget.name, e.currentTarget.value, e.currentTarget.id);
        });
    }
    

}
export function lineColorChanger(name, color, id){
    if(id === 'node'){
        var gp = parseInt(name)
        userColors[gp] = color;
        data.nodes.forEach(node =>{
            if(node.gp === gp){
                node.itemStyle.normal.color = color;
            }
        });
        option.series[0].nodes.forEach(node =>{
            if(node.gp === gp){
                node.itemStyle.normal.color = color;
            }
        });
    }
    else{
        data.category.forEach(category =>{
            if(category.name === name){
                category.itemStyle.color = color;
                category.lineStyle.normal.color = color;
            }
        });
        option.series[0].categories.forEach(category =>{
            if(category.name === name){
                category.itemStyle.color = color;
                category.lineStyle.normal.color = color;
            }
        });
        option.series[0].links.forEach(category =>{
            if(category.name === name){
                category.itemStyle.color = color;
                category.lineStyle.normal.color = color;
            }
        });
    }
    event_setOption_function();
}
Chart.on('click', (e) => {
    // console.log(e);
    console.log(book_id,e.data.source, e.data.target, e.data.name);
    if(book_id.indexOf("_")==-1)
    {
        if(e.data.source==undefined &amp;&amp; e.data.target==undefined)
            searchBookUnit(book_id,e.data.name); 
        else
            searchBookAssociation(book_id, e.data.source, e.data.target,  e.data.name);
    }

    function searchBookAssociation(bid, key1, key2, relation) {
        var associationQuery = '"' + key1 + '" AND "' + key2 + '"';
        // http://dh.ascdc.sinica.edu.tw/member/text/segementRelationDetails.jsp
        $.get(window.location.origin+'/member/text/segementRelationDetails.jsp', {
            'bid': bid,
            'searchKey': associationQuery,
            'pages': 1,
            'isStart': '1',
            'relation': relation
        }, function (data) {
            //$('#layout_main').html(data);
            var w = window.open('about:blank', key1 + key2, 'width=800,height=600');
            w.document.write(data);
            w.document.close();
        });
    }
    function searchBookUnit(bid,associationKey){
    //alert(bid);
    var associationQuery = "";
    associationQuery = '"'+associationKey+'"';
    //$('#searchKey').val(associationKey);
    $.get(window.location.origin+'/member/text/segementDetails.jsp',{'only_show_authority':$("#only_show_authority").val(),'show_info':$("#show_info").val(),'pageNums':$("#pageNums").val(),'bookID':bid,'bid':bid,'searchKey':associationQuery,'ckDic':$("#DicCK").prop("checked"),'pages': 1,'isStart':'1'}, function(data) {
            //$('#layout_main').html(data);
            var w = window.open('about:blank', associationKey,'width=800,height=600');
            w.document.write(data);
            w.document.close();
            
    });
    
}
});

function nodeListChange(e) {
    console.log(e.target.value);
    keywordItemAppend(e.target.value, 'not', 'node');
    keywordFliter();
}

function edgeFilter(){																					
    option.series[0].links.forEach(function(link,index,array){
        if(edgeMask[1].includes(link.id)){
            option.series[0].links.splice(index,1);
        }
        if(edgeMask[0].includes(link.id)){
            link.symbol = 'arrow';
        }
    })
}
// function nodeTypeChange(){
// 	let target = option.series[0].links.map(function(item, index, array) {
// 		return item.target;
// 	});
// 	let source = option.series[0].links.map(function(item, index, array) {
// 		return item.source;
// 	});
// 		option.series[0].nodes.forEach(item =>{
// 		if(item.itemStyle.normal.color == "red"){

// 			}
// 		else if(source.includes(item.name) &amp;&amp; target.includes(item.name)){
// 			item.symbol = "circle"
// 			item.itemStyle.normal.color = "#955539";
// 		}
// 		else if(target.includes(item.name)){
// 			item.symbol = "rect"
// 			item.itemStyle.normal.color = '#4c8dae';
// 		}
// 		else if(source.includes(item.name)){
// 			item.symbol = "roundRect"
// 			item.itemStyle.normal.color = "#789262";
// 		}
// 		else if(!source.includes(item.name) &amp;&amp; !target.includes(item.name)){
// 			item.symbol = "circle"
// 			item.itemStyle.normal.color = "#ceb888";
// 		}
// 	});
// }</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Sat Jun 26 2021 14:49:14 GMT+0800 (台北標準時間) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
